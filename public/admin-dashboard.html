<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Super Admin Dashboard - ContentScale</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .tab-button {
      transition: all 0.2s;
    }
    .tab-button.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
  
  <!-- Login Screen -->
  <div id="login-screen" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900">
    <div class="bg-gray-800 p-8 rounded-lg shadow-2xl w-full max-w-md border border-purple-500">
      <div class="flex items-center justify-center mb-6">
        <span class="text-4xl">üëë</span>
        <h1 class="text-2xl font-bold ml-3 bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
          Super Admin Dashboard
        </h1>
      </div>
      <p class="text-gray-400 text-center mb-6">ContentScale Platform Control Center</p>
      
      <div id="login-error" class="hidden mb-4 p-3 bg-red-900 border border-red-700 rounded text-red-200 text-sm"></div>
      
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Username</label>
          <input type="text" id="login-username" 
            class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-white"
            placeholder="Enter username">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Password</label>
          <input type="password" id="login-password" 
            class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-white"
            placeholder="Enter password">
        </div>
        
        <button onclick="login()" id="login-btn"
          class="w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 rounded-lg font-semibold transition-all transform hover:scale-105">
          Login
        </button>
      </div>
    </div>
  </div>

  <!-- Main Dashboard -->
  <div id="main-dashboard" class="hidden">
    <!-- Header -->
    <header class="bg-gray-800 border-b border-gray-700 sticky top-0 z-50">
      <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
        <div class="flex items-center space-x-3">
          <span class="text-3xl">üëë</span>
          <div>
            <h1 class="text-xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
              Super Admin Dashboard
            </h1>
            <p class="text-xs text-gray-400">ContentScale Platform Control Center</p>
          </div>
        </div>
        <div class="flex items-center space-x-4">
          <span class="text-sm text-gray-400">
            Logged in as: <span class="text-blue-400 font-semibold" id="admin-username"></span>
          </span>
          <button onclick="logout()" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm font-semibold transition-all">
            Logout
          </button>
        </div>
      </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="bg-gray-800 border-b border-gray-700 sticky top-[73px] z-40">
      <div class="max-w-7xl mx-auto px-4">
        <div class="flex space-x-1 overflow-x-auto">
          <button onclick="switchTab('overview')" class="tab-button active px-4 py-3 rounded-t-lg text-sm font-medium whitespace-nowrap">
            üìä Overview
          </button>
          <button onclick="switchTab('admins')" class="tab-button px-4 py-3 rounded-t-lg text-sm font-medium whitespace-nowrap hover:bg-gray-700">
            üë• Admins
          </button>
          <button onclick="switchTab('agencies')" class="tab-button px-4 py-3 rounded-t-lg text-sm font-medium whitespace-nowrap hover:bg-gray-700">
            üè¢ Agencies
          </button>
          <button onclick="switchTab('clients')" class="tab-button px-4 py-3 rounded-t-lg text-sm font-medium whitespace-nowrap hover:bg-gray-700">
            üë§ All Clients
          </button>
          <button onclick="switchTab('scans')" class="tab-button px-4 py-3 rounded-t-lg text-sm font-medium whitespace-nowrap hover:bg-gray-700">
            üîç All Scans
          </button>
          <button onclick="switchTab('share-links')" class="tab-button px-4 py-3 rounded-t-lg text-sm font-medium whitespace-nowrap hover:bg-gray-700">
            üîó Share Links
          </button>
          <button onclick="switchTab('leaderboard')" class="tab-button px-4 py-3 rounded-t-lg text-sm font-medium whitespace-nowrap hover:bg-gray-700">
            üèÜ Leaderboard
          </button>
          <button onclick="switchTab('lead-scanner')" class="tab-button px-4 py-3 rounded-t-lg text-sm font-medium whitespace-nowrap hover:bg-gray-700">
            üéØ Lead Scanner
          </button>
          <button onclick="switchTab('contentscore')" class="tab-button px-4 py-3 rounded-t-lg text-sm font-medium whitespace-nowrap hover:bg-gray-700">
            üìä ContentScore
          </button>
          <button onclick="switchTab('code-generators')" class="tab-button px-4 py-3 rounded-t-lg text-sm font-medium whitespace-nowrap hover:bg-gray-700">
            üé® Code Generators
          </button>
          <button onclick="switchTab('ltd-codes')" class="tab-button px-4 py-3 rounded-t-lg text-sm font-medium whitespace-nowrap hover:bg-gray-700">
            üí∞ LTD Codes
          </button>
          <button onclick="switchTab('settings')" class="tab-button px-4 py-3 rounded-t-lg text-sm font-medium whitespace-nowrap hover:bg-gray-700">
            ‚öôÔ∏è Settings
          </button>
          <button onclick="switchTab('handleiding')" class="tab-button px-4 py-3 rounded-t-lg text-sm font-medium whitespace-nowrap hover:bg-gray-700">
            üìö Handleiding
          </button>
        </div>
      </div>
    </nav>

    <!-- Tab Content -->
    <main class="max-w-7xl mx-auto px-4 py-8">
      
      <!-- Overview Tab -->
      <div id="tab-overview" class="tab-content">
        <h2 class="text-2xl font-bold mb-6">Platform Overview</h2>
        
        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
          <div class="stat-card p-6 rounded-lg shadow-lg text-white">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm opacity-90">Total Agencies</p>
                <p class="text-3xl font-bold mt-2" id="stat-total-agencies">-</p>
              </div>
              <span class="text-5xl opacity-50">üè¢</span>
            </div>
          </div>
          
          <div class="stat-card p-6 rounded-lg shadow-lg text-white">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm opacity-90">Total Clients</p>
                <p class="text-3xl font-bold mt-2" id="stat-total-clients">-</p>
              </div>
              <span class="text-5xl opacity-50">üë•</span>
            </div>
          </div>
          
          <div class="stat-card p-6 rounded-lg shadow-lg text-white">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm opacity-90">Total Scans</p>
                <p class="text-3xl font-bold mt-2" id="stat-total-scans">-</p>
              </div>
              <span class="text-5xl opacity-50">üîç</span>
            </div>
          </div>
          
          <div class="stat-card p-6 rounded-lg shadow-lg text-white">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm opacity-90">Active Helpers</p>
                <p class="text-3xl font-bold mt-2" id="stat-active-helpers">-</p>
              </div>
              <span class="text-5xl opacity-50">ü§ù</span>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="bg-gray-800 rounded-lg p-6 shadow-lg mb-8">
          <h3 class="text-xl font-bold mb-4">Quick Actions</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <button onclick="switchTab('agencies')" class="p-4 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-all">
              ‚ûï Add Agency
            </button>
            <button onclick="switchTab('admins')" class="p-4 bg-green-600 hover:bg-green-700 rounded-lg font-semibold transition-all">
              üë§ Add Helper
            </button>
            <button onclick="switchTab('share-links')" class="p-4 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold transition-all">
              üîó Create Share Link
            </button>
            <button onclick="switchTab('leaderboard')" class="p-4 bg-orange-600 hover:bg-orange-700 rounded-lg font-semibold transition-all">
              üéØ Scan Leads
            </button>
          </div>
        </div>

        <!-- Platform Health -->
        <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
          <h3 class="text-xl font-bold mb-4">Platform Health</h3>
          <div class="space-y-3">
            <div class="flex items-center justify-between p-3 bg-gray-700 rounded">
              <span>Database Connection</span>
              <span class="text-green-400 font-semibold">‚úÖ Connected</span>
            </div>
            <div class="flex items-center justify-between p-3 bg-gray-700 rounded">
              <span>API Status</span>
              <span class="text-green-400 font-semibold">‚úÖ Operational</span>
            </div>
            <div class="flex items-center justify-between p-3 bg-gray-700 rounded">
              <span>Auto-Scan Service</span>
              <span class="text-yellow-400 font-semibold">‚è∏Ô∏è Paused</span>
            </div>
            <div class="flex items-center justify-between p-3 bg-gray-700 rounded">
              <span>Last Backup</span>
              <span class="text-gray-400">2 hours ago</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Agencies Tab -->
      <div id="tab-agencies" class="tab-content hidden">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold">All Agencies</h2>
          <button onclick="showAddAgencyModal()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-all">
            ‚ûï Add Agency
          </button>
        </div>

        <div id="agencies-loading" class="text-center py-12">
          <div class="inline-block animate-spin text-4xl">‚è≥</div>
          <p class="text-gray-400 mt-4">Loading agencies...</p>
        </div>

        <div id="agencies-list" class="hidden bg-gray-800 rounded-lg overflow-hidden">
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-gray-700">
                <tr>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Name</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Domain</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Country</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Plan</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Clients</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Scans</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Status</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Actions</th>
                </tr>
              </thead>
              <tbody id="agencies-tbody" class="divide-y divide-gray-700">
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Clients Tab -->
      <div id="tab-clients" class="tab-content hidden">
        <h2 class="text-2xl font-bold mb-6">All Clients</h2>

        <div id="clients-loading" class="text-center py-12">
          <div class="inline-block animate-spin text-4xl">‚è≥</div>
          <p class="text-gray-400 mt-4">Loading clients...</p>
        </div>

        <div id="clients-list" class="hidden bg-gray-800 rounded-lg overflow-hidden">
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-gray-700">
                <tr>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Name</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">URL</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Agency</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Scans</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Last Scan</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Actions</th>
                </tr>
              </thead>
              <tbody id="clients-tbody" class="divide-y divide-gray-700">
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Scans Tab -->
      <div id="tab-scans" class="tab-content hidden">
        <h2 class="text-2xl font-bold mb-6">All Scans</h2>

        <div id="scans-loading" class="text-center py-12">
          <div class="inline-block animate-spin text-4xl">‚è≥</div>
          <p class="text-gray-400 mt-4">Loading scans...</p>
        </div>

        <div id="scans-list" class="hidden bg-gray-800 rounded-lg overflow-hidden">
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-gray-700">
                <tr>
                  <th class="px-4 py-3 text-left text-sm font-semibold">URL</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Score</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Quality</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Agency/Client</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Type</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Date</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Actions</th>
                </tr>
              </thead>
              <tbody id="scans-tbody" class="divide-y divide-gray-700">
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Share Links Tab -->
      <div id="tab-share-links" class="tab-content hidden">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold">Share Links</h2>
          <button onclick="showCreateShareLinkModal()" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold transition-all">
            ‚ûï Create Share Link
          </button>
        </div>

        <div id="share-links-loading" class="text-center py-12">
          <div class="inline-block animate-spin text-4xl">‚è≥</div>
          <p class="text-gray-400 mt-4">Loading share links...</p>
        </div>

        <div id="share-links-list" class="hidden bg-gray-800 rounded-lg overflow-hidden">
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-gray-700">
                <tr>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Client</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Email</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Usage</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Expires</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Status</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Actions</th>
                </tr>
              </thead>
              <tbody id="share-links-tbody" class="divide-y divide-gray-700">
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Leaderboard Tab -->
      <div id="tab-leaderboard" class="tab-content hidden">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold">Global Leaderboard Management</h2>
          <button onclick="scanAllAgencies()" class="px-4 py-2 bg-orange-600 hover:bg-orange-700 rounded-lg font-semibold transition-all">
            üîç Scan Alle Agencies Nu
          </button>
        </div>

        <div class="mb-4 flex gap-4">
          <input type="text" id="leaderboard-search" placeholder="Search by URL, company, or score..." 
            class="flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
          <button onclick="searchLeaderboard()" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold">
            Search
          </button>
        </div>

        <div id="leaderboard-list" class="bg-gray-800 rounded-lg overflow-hidden">
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-gray-700">
                <tr>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Rank</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Company</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">URL</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Score</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Country</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Actions</th>
                </tr>
              </thead>
              <tbody id="leaderboard-tbody" class="divide-y divide-gray-700">
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Admins Tab -->
      <div id="tab-admins" class="tab-content hidden">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold">Admin & Helper Management</h2>
          <button onclick="showAddAdminModal()" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg font-semibold transition-all">
            ‚ûï Add Admin/Helper
          </button>
        </div>

        <div id="admins-loading" class="text-center py-12">
          <div class="inline-block animate-spin text-4xl">‚è≥</div>
          <p class="text-gray-400 mt-4">Loading admins...</p>
        </div>

        <div id="admins-list" class="hidden bg-gray-800 rounded-lg overflow-hidden">
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-gray-700">
                <tr>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Username</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Full Name</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Email</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Role</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Status</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Created</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Last Login</th>
                  <th class="px-4 py-3 text-left text-sm font-semibold">Actions</th>
                </tr>
              </thead>
              <tbody id="admins-tbody" class="divide-y divide-gray-700">
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tab-lead-scanner" class="tab-content hidden">
        <h2 class="text-2xl font-bold mb-6">Lead Scanner</h2>
        <p class="text-gray-400">Coming soon...</p>
      </div>

      <div id="tab-contentscore" class="tab-content hidden">
        <h2 class="text-2xl font-bold mb-6">ContentScore Tool</h2>
        <iframe src="/seo-contentscore" class="w-full h-screen border-0 rounded-lg"></iframe>
      </div>

      <div id="tab-code-generators" class="tab-content hidden">
        <h2 class="text-2xl font-bold mb-6">Code Generators</h2>
        <p class="text-gray-400">Coming soon...</p>
      </div>

      <div id="tab-ltd-codes" class="tab-content hidden">
        <h2 class="text-2xl font-bold mb-6">LTD Codes</h2>
        <p class="text-gray-400">Coming soon...</p>
      </div>

      <div id="tab-settings" class="tab-content hidden">
        <h2 class="text-2xl font-bold mb-6">Platform Settings</h2>
        <p class="text-gray-400">Coming soon...</p>
      </div>

      <div id="tab-handleiding" class="tab-content hidden">
        <h2 class="text-2xl font-bold mb-6">Handleiding (Dutch Documentation)</h2>
        <p class="text-gray-400">Coming soon...</p>
      </div>

    </main>
  </div>

  <!-- Add Agency Modal -->
  <div id="modal-add-agency" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
    <div class="bg-gray-800 rounded-lg p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-2xl font-bold">Add New Agency</h3>
        <button onclick="closeModal('modal-add-agency')" class="text-gray-400 hover:text-white text-2xl">&times;</button>
      </div>

      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-2">Agency Name *</label>
          <input type="text" id="agency-name" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
        </div>

        <div>
          <label class="block text-sm font-medium mb-2">Domain *</label>
          <input type="text" id="agency-domain" placeholder="example.com" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
        </div>

        <div>
          <label class="block text-sm font-medium mb-2">Country *</label>
          <select id="agency-country" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
            <option value="NL">Netherlands</option>
            <option value="BE">Belgium</option>
            <option value="DE">Germany</option>
            <option value="UK">United Kingdom</option>
            <option value="US">United States</option>
            <option value="OTHER">Other</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium mb-2">Plan *</label>
          <select id="agency-plan" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
            <option value="free">Free</option>
            <option value="basic">Basic</option>
            <option value="pro">Pro</option>
            <option value="enterprise">Enterprise</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium mb-2">Contact Person</label>
          <input type="text" id="agency-contact-person" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
        </div>

        <div>
          <label class="block text-sm font-medium mb-2">Contact Email</label>
          <input type="email" id="agency-contact-email" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
        </div>

        <div class="flex gap-4 mt-6">
          <button onclick="submitAddAgency()" class="flex-1 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold">
            Create Agency
          </button>
          <button onclick="closeModal('modal-add-agency')" class="flex-1 py-3 bg-gray-600 hover:bg-gray-700 rounded-lg font-semibold">
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Create Share Link Modal -->
  <div id="modal-create-share-link" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
    <div class="bg-gray-800 rounded-lg p-8 max-w-2xl w-full mx-4">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-2xl font-bold">Create Share Link</h3>
        <button onclick="closeModal('modal-create-share-link')" class="text-gray-400 hover:text-white text-2xl">&times;</button>
      </div>

      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-2">Client Email *</label>
          <input type="email" id="share-client-email" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
        </div>

        <div>
          <label class="block text-sm font-medium mb-2">Client Name</label>
          <input type="text" id="share-client-name" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
        </div>

        <div>
          <label class="block text-sm font-medium mb-2">Company</label>
          <input type="text" id="share-client-company" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
        </div>

        <div>
          <label class="block text-sm font-medium mb-2">Scans Limit *</label>
          <input type="number" id="share-scans-limit" value="5" min="1" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
        </div>

        <div>
          <label class="block text-sm font-medium mb-2">Valid For (Days) *</label>
          <input type="number" id="share-valid-days" value="30" min="1" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
        </div>

        <div class="flex gap-4 mt-6">
          <button onclick="submitCreateShareLink()" class="flex-1 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold">
            Create Link
          </button>
          <button onclick="closeModal('modal-create-share-link')" class="flex-1 py-3 bg-gray-600 hover:bg-gray-700 rounded-lg font-semibold">
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Admin/Helper Modal -->
  <div id="modal-add-admin" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
    <div class="bg-gray-800 rounded-lg p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-2xl font-bold">Add Admin/Helper</h3>
        <button onclick="closeModal('modal-add-admin')" class="text-gray-400 hover:text-white text-2xl">&times;</button>
      </div>

      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-2">Username *</label>
          <input type="text" id="admin-username" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
        </div>

        <div>
          <label class="block text-sm font-medium mb-2">Password *</label>
          <input type="password" id="admin-password" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
          <p class="text-xs text-gray-400 mt-1">Minimum 8 characters</p>
        </div>

        <div>
          <label class="block text-sm font-medium mb-2">Role *</label>
          <select id="admin-role" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
            <option value="helper">Helper (Limited Access)</option>
            <option value="super_admin">Super Admin (Full Access)</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium mb-2">Full Name</label>
          <input type="text" id="admin-full-name" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
        </div>

        <div>
          <label class="block text-sm font-medium mb-2">Email</label>
          <input type="email" id="admin-email" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
        </div>

        <div class="bg-blue-900 border border-blue-700 rounded-lg p-4 mt-4">
          <p class="text-sm text-blue-200">
            <strong>Helper Role:</strong> Can view data and perform basic tasks<br>
            <strong>Super Admin Role:</strong> Full platform control including user management
          </p>
        </div>

        <div class="flex gap-4 mt-6">
          <button onclick="submitAddAdmin()" class="flex-1 py-3 bg-green-600 hover:bg-green-700 rounded-lg font-semibold">
            Create Admin/Helper
          </button>
          <button onclick="closeModal('modal-add-admin')" class="flex-1 py-3 bg-gray-600 hover:bg-gray-700 rounded-lg font-semibold">
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ==========================================
    // AUTHENTICATION
    // ==========================================
    async function login() {
      const username = document.getElementById('login-username').value;
      const password = document.getElementById('login-password').value;
      const errorDiv = document.getElementById('login-error');
      
      if (!username || !password) {
        errorDiv.textContent = 'Please enter username and password';
        errorDiv.classList.remove('hidden');
        return;
      }
      
      try {
        const response = await fetch('/api/setup/verify-admin', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });
        
        const data = await response.json();
        
        if (data.success) {
          localStorage.setItem('admin_id', data.admin_id);
          sessionStorage.setItem('superadmin_logged_in', 'true');
          sessionStorage.setItem('superadmin_username', data.admin.username);
          
          document.getElementById('login-screen').classList.add('hidden');
          document.getElementById('main-dashboard').classList.remove('hidden');
          document.getElementById('admin-username').textContent = data.admin.username;
          
          loadOverview();
        } else {
          errorDiv.textContent = data.error || 'Login failed';
          errorDiv.classList.remove('hidden');
        }
      } catch (error) {
        console.error('Login error:', error);
        errorDiv.textContent = 'Connection error';
        errorDiv.classList.remove('hidden');
      }
    }

    function logout() {
      localStorage.removeItem('admin_id');
      sessionStorage.removeItem('superadmin_logged_in');
      sessionStorage.removeItem('superadmin_username');
      location.reload();
    }

    // Check login on page load
    if (sessionStorage.getItem('superadmin_logged_in') === 'true') {
      document.getElementById('login-screen').classList.add('hidden');
      document.getElementById('main-dashboard').classList.remove('hidden');
      document.getElementById('admin-username').textContent = sessionStorage.getItem('superadmin_username');
      loadOverview();
    }

    // ==========================================
    // TAB SWITCHING
    // ==========================================
    function switchTab(tabName) {
      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden');
      });
      
      // Remove active class from all buttons
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Show selected tab
      document.getElementById(`tab-${tabName}`).classList.remove('hidden');
      
      // Add active class to clicked button
      event.target.classList.add('active');
      
      // Load data for specific tabs
      if (tabName === 'overview') loadOverview();
      if (tabName === 'admins') loadAdmins();
      if (tabName === 'agencies') loadAgencies();
      if (tabName === 'clients') loadClients();
      if (tabName === 'scans') loadScans();
      if (tabName === 'share-links') loadShareLinks();
      if (tabName === 'leaderboard') loadLeaderboard();
    }

    // ==========================================
    // ADMINS TAB
    // ==========================================
    async function loadAdmins() {
      document.getElementById('admins-loading').classList.remove('hidden');
      document.getElementById('admins-list').classList.add('hidden');
      
      try {
        const response = await fetch('/api/admins', {
          headers: { 'x-admin-key': localStorage.getItem('admin_id') }
        });
        
        if (!response.ok) throw new Error('Failed to load admins');
        
        const data = await response.json();
        
        if (data.success) {
          const tbody = document.getElementById('admins-tbody');
          tbody.innerHTML = '';
          
          data.admins.forEach(admin => {
            const roleColors = {
              'super_admin': 'bg-purple-600',
              'helper': 'bg-blue-600',
              'admin': 'bg-green-600'
            };
            
            const roleColor = roleColors[admin.role] || 'bg-gray-600';
            
            const row = `
              <tr>
                <td class="px-4 py-3 font-semibold">${admin.username}</td>
                <td class="px-4 py-3">${admin.full_name || '-'}</td>
                <td class="px-4 py-3 text-sm">${admin.email || '-'}</td>
                <td class="px-4 py-3">
                  <span class="px-2 py-1 ${roleColor} rounded text-xs font-semibold">
                    ${admin.role.replace('_', ' ').toUpperCase()}
                  </span>
                </td>
                <td class="px-4 py-3">
                  ${admin.is_active 
                    ? '<span class="text-green-400">‚úÖ Active</span>' 
                    : '<span class="text-red-400">‚ùå Inactive</span>'}
                </td>
                <td class="px-4 py-3 text-sm">${new Date(admin.created_at).toLocaleDateString()}</td>
                <td class="px-4 py-3 text-sm">${admin.last_login ? new Date(admin.last_login).toLocaleDateString() : 'Never'}</td>
                <td class="px-4 py-3">
                  <button onclick="deleteAdmin('${admin.id}')" class="text-red-400 hover:text-red-300">
                    üóëÔ∏è Delete
                  </button>
                </td>
              </tr>
            `;
            tbody.innerHTML += row;
          });
          
          document.getElementById('admins-loading').classList.add('hidden');
          document.getElementById('admins-list').classList.remove('hidden');
        }
      } catch (error) {
        console.error('Error loading admins:', error);
        document.getElementById('admins-loading').innerHTML = '<p class="text-red-400">Error loading admins</p>';
      }
    }

    async function submitAddAdmin() {
      const formData = {
        username: document.getElementById('admin-username').value,
        password: document.getElementById('admin-password').value,
        role: document.getElementById('admin-role').value,
        full_name: document.getElementById('admin-full-name').value,
        email: document.getElementById('admin-email').value
      };
      
      // Validation
      if (!formData.username || formData.username.length < 3) {
        alert('Username must be at least 3 characters');
        return;
      }
      
      if (!formData.password || formData.password.length < 8) {
        alert('Password must be at least 8 characters');
        return;
      }
      
      if (!formData.role) {
        alert('Please select a role');
        return;
      }
      
      try {
        const response = await fetch('/api/admins', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'x-admin-key': localStorage.getItem('admin_id')
          },
          body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (data.success) {
          alert('Admin/Helper created successfully!');
          closeModal('modal-add-admin');
          
          // Clear form
          document.getElementById('admin-username').value = '';
          document.getElementById('admin-password').value = '';
          document.getElementById('admin-role').value = 'helper';
          document.getElementById('admin-full-name').value = '';
          document.getElementById('admin-email').value = '';
          
          loadAdmins();
        } else {
          alert('Error: ' + data.error);
        }
      } catch (error) {
        console.error('Error creating admin:', error);
        alert('Failed to create admin/helper');
      }
    }

    async function deleteAdmin(adminId) {
      if (!confirm('Are you sure you want to delete this admin/helper?')) return;
      
      try {
        const response = await fetch(`/api/admins/${adminId}`, {
          method: 'DELETE',
          headers: { 'x-admin-key': localStorage.getItem('admin_id') }
        });
        
        const data = await response.json();
        
        if (data.success) {
          alert('Admin/Helper deleted successfully!');
          loadAdmins();
        } else {
          alert('Error: ' + data.error);
        }
      } catch (error) {
        console.error('Error deleting admin:', error);
        alert('Failed to delete admin/helper');
      }
    }

    function showAddAdminModal() {
      document.getElementById('modal-add-admin').classList.remove('hidden');
    }

    // ==========================================
    // OVERVIEW TAB
    // ==========================================
    async function loadOverview() {
      try {
        const response = await fetch('/api/admin/stats', {
          headers: { 'x-admin-key': localStorage.getItem('admin_id') }
        });
        
        const data = await response.json();
        
        if (data.success) {
          document.getElementById('stat-total-agencies').textContent = data.stats.total_agencies;
          document.getElementById('stat-total-clients').textContent = data.stats.total_clients;
          document.getElementById('stat-total-scans').textContent = data.stats.total_scans;
          document.getElementById('stat-active-helpers').textContent = data.stats.active_helpers;
        }
      } catch (error) {
        console.error('Error loading overview:', error);
      }
    }

    // ==========================================
    // AGENCIES TAB
    // ==========================================
    async function loadAgencies() {
      document.getElementById('agencies-loading').classList.remove('hidden');
      document.getElementById('agencies-list').classList.add('hidden');
      
      try {
        const response = await fetch('/api/super-admin/agencies', {
          headers: { 'x-admin-key': localStorage.getItem('admin_id') }
        });
        
        if (!response.ok) throw new Error('Failed to load agencies');
        
        const data = await response.json();
        
        if (data.success) {
          const tbody = document.getElementById('agencies-tbody');
          tbody.innerHTML = '';
          
          data.agencies.forEach(agency => {
            const row = `
              <tr>
                <td class="px-4 py-3">${agency.name}</td>
                <td class="px-4 py-3">${agency.domain}</td>
                <td class="px-4 py-3">${agency.country}</td>
                <td class="px-4 py-3"><span class="px-2 py-1 bg-blue-600 rounded text-xs">${agency.plan}</span></td>
                <td class="px-4 py-3">${agency.client_count || 0}</td>
                <td class="px-4 py-3">${agency.total_scans || 0}</td>
                <td class="px-4 py-3">
                  ${agency.is_active ? '<span class="text-green-400">‚úÖ Active</span>' : '<span class="text-red-400">‚ùå Inactive</span>'}
                </td>
                <td class="px-4 py-3">
                  <button onclick="deleteAgency(${agency.id})" class="text-red-400 hover:text-red-300">üóëÔ∏è Delete</button>
                </td>
              </tr>
            `;
            tbody.innerHTML += row;
          });
          
          document.getElementById('agencies-loading').classList.add('hidden');
          document.getElementById('agencies-list').classList.remove('hidden');
        }
      } catch (error) {
        console.error('Error loading agencies:', error);
        document.getElementById('agencies-loading').innerHTML = '<p class="text-red-400">Error loading agencies</p>';
      }
    }

    async function submitAddAgency() {
      const formData = {
        name: document.getElementById('agency-name').value,
        domain: document.getElementById('agency-domain').value,
        country: document.getElementById('agency-country').value,
        plan: document.getElementById('agency-plan').value,
        contact_person: document.getElementById('agency-contact-person').value,
        contact_email: document.getElementById('agency-contact-email').value
      };
      
      try {
        const response = await fetch('/api/agencies', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'x-admin-key': localStorage.getItem('admin_id')
          },
          body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (data.success) {
          alert('Agency created successfully!');
          closeModal('modal-add-agency');
          loadAgencies();
        } else {
          alert('Error: ' + data.error);
        }
      } catch (error) {
        console.error('Error creating agency:', error);
        alert('Failed to create agency');
      }
    }

    async function deleteAgency(id) {
      if (!confirm('Are you sure you want to delete this agency?')) return;
      
      try {
        const response = await fetch(`/api/agencies/${id}`, {
          method: 'DELETE',
          headers: { 'x-admin-key': localStorage.getItem('admin_id') }
        });
        
        const data = await response.json();
        
        if (data.success) {
          alert('Agency deleted successfully!');
          loadAgencies();
        } else {
          alert('Error: ' + data.error);
        }
      } catch (error) {
        console.error('Error deleting agency:', error);
        alert('Failed to delete agency');
      }
    }

    // ==========================================
    // CLIENTS TAB
    // ==========================================
    async function loadClients() {
      document.getElementById('clients-loading').classList.remove('hidden');
      document.getElementById('clients-list').classList.add('hidden');
      
      try {
        const response = await fetch('/api/admin/clients', {
          headers: { 'x-admin-key': localStorage.getItem('admin_id') }
        });
        
        const data = await response.json();
        
        if (data.success) {
          const tbody = document.getElementById('clients-tbody');
          tbody.innerHTML = '';
          
          data.clients.forEach(client => {
            const row = `
              <tr>
                <td class="px-4 py-3">${client.name || 'Unknown'}</td>
                <td class="px-4 py-3 text-blue-400">${client.url}</td>
                <td class="px-4 py-3">${client.agency_name || '-'}</td>
                <td class="px-4 py-3">${client.scan_count || 0}</td>
                <td class="px-4 py-3">${client.last_scan_at ? new Date(client.last_scan_at).toLocaleDateString() : 'Never'}</td>
                <td class="px-4 py-3">
                  <button onclick="deleteClient(${client.id})" class="text-red-400 hover:text-red-300">üóëÔ∏è Delete</button>
                </td>
              </tr>
            `;
            tbody.innerHTML += row;
          });
          
          document.getElementById('clients-loading').classList.add('hidden');
          document.getElementById('clients-list').classList.remove('hidden');
        }
      } catch (error) {
        console.error('Error loading clients:', error);
        document.getElementById('clients-loading').innerHTML = '<p class="text-red-400">Error loading clients</p>';
      }
    }

    async function deleteClient(id) {
      if (!confirm('Delete this client and all associated scans?')) return;
      
      try {
        const response = await fetch(`/api/admin/clients/${id}`, {
          method: 'DELETE',
          headers: { 'x-admin-key': localStorage.getItem('admin_id') }
        });
        
        const data = await response.json();
        
        if (data.success) {
          alert('Client deleted successfully!');
          loadClients();
        } else {
          alert('Error: ' + data.error);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Failed to delete client');
      }
    }

    // ==========================================
    // SCANS TAB
    // ==========================================
    async function loadScans() {
      document.getElementById('scans-loading').classList.remove('hidden');
      document.getElementById('scans-list').classList.add('hidden');
      
      try {
        const response = await fetch('/api/admin/scans', {
          headers: { 'x-admin-key': localStorage.getItem('admin_id') }
        });
        
        const data = await response.json();
        
        if (data.success) {
          const tbody = document.getElementById('scans-tbody');
          tbody.innerHTML = '';
          
          data.scans.forEach(scan => {
            const qualityColors = {
              excellent: 'text-green-400',
              good: 'text-blue-400',
              average: 'text-yellow-400',
              'below-average': 'text-orange-400',
              poor: 'text-red-400'
            };
            
            const row = `
              <tr>
                <td class="px-4 py-3 text-blue-400 text-sm">${scan.url.substring(0, 50)}...</td>
                <td class="px-4 py-3 font-bold">${scan.score}/100</td>
                <td class="px-4 py-3 ${qualityColors[scan.quality] || 'text-gray-400'}">${scan.quality}</td>
                <td class="px-4 py-3 text-sm">${scan.agency_name || scan.client_name || '-'}</td>
                <td class="px-4 py-3"><span class="px-2 py-1 bg-gray-700 rounded text-xs">${scan.scan_type}</span></td>
                <td class="px-4 py-3 text-sm">${new Date(scan.created_at).toLocaleDateString()}</td>
                <td class="px-4 py-3">
                  <button onclick="deleteScan(${scan.id})" class="text-red-400 hover:text-red-300">üóëÔ∏è</button>
                </td>
              </tr>
            `;
            tbody.innerHTML += row;
          });
          
          document.getElementById('scans-loading').classList.add('hidden');
          document.getElementById('scans-list').classList.remove('hidden');
        }
      } catch (error) {
        console.error('Error loading scans:', error);
        document.getElementById('scans-loading').innerHTML = '<p class="text-red-400">Error loading scans</p>';
      }
    }

    async function deleteScan(id) {
      if (!confirm('Delete this scan?')) return;
      
      try {
        const response = await fetch(`/api/admin/scans/${id}`, {
          method: 'DELETE',
          headers: { 'x-admin-key': localStorage.getItem('admin_id') }
        });
        
        const data = await response.json();
        
        if (data.success) {
          loadScans();
        } else {
          alert('Error: ' + data.error);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Failed to delete scan');
      }
    }

    // ==========================================
    // SHARE LINKS TAB
    // ==========================================
    async function loadShareLinks() {
      document.getElementById('share-links-loading').classList.remove('hidden');
      document.getElementById('share-links-list').classList.add('hidden');
      
      try {
        const response = await fetch('/api/admin/share-links', {
          headers: { 'x-admin-key': localStorage.getItem('admin_id') }
        });
        
        const data = await response.json();
        
        if (data.success) {
          const tbody = document.getElementById('share-links-tbody');
          tbody.innerHTML = '';
          
          data.share_links.forEach(link => {
            const statusColors = {
              active: 'text-green-400',
              expired: 'text-red-400',
              limit_reached: 'text-orange-400',
              inactive: 'text-gray-400'
            };
            
            const shareUrl = `${window.location.origin}/scan-with-link/${link.share_code}`;
            
            const row = `
              <tr>
                <td class="px-4 py-3">${link.client_name || '-'}</td>
                <td class="px-4 py-3 text-sm">${link.client_email}</td>
                <td class="px-4 py-3">${link.scans_used}/${link.scans_limit}</td>
                <td class="px-4 py-3 text-sm">${new Date(link.expires_at).toLocaleDateString()}</td>
                <td class="px-4 py-3 ${statusColors[link.status]}">${link.status}</td>
                <td class="px-4 py-3 space-x-2">
                  <button onclick="window.open('${shareUrl}', '_blank')" class="text-blue-400 hover:text-blue-300" title="View">üëÅÔ∏è</button>
                  <button onclick="copyShareUrl('${shareUrl}')" class="text-green-400 hover:text-green-300" title="Copy URL">üìã</button>
                  <button onclick="deleteShareLink('${link.share_code}')" class="text-red-400 hover:text-red-300" title="Delete">üóëÔ∏è</button>
                </td>
              </tr>
            `;
            tbody.innerHTML += row;
          });
          
          document.getElementById('share-links-loading').classList.add('hidden');
          document.getElementById('share-links-list').classList.remove('hidden');
        }
      } catch (error) {
        console.error('Error loading share links:', error);
        document.getElementById('share-links-loading').innerHTML = '<p class="text-red-400">Error loading share links</p>';
      }
    }

    async function submitCreateShareLink() {
      const formData = {
        client_email: document.getElementById('share-client-email').value,
        client_name: document.getElementById('share-client-name').value,
        client_company: document.getElementById('share-client-company').value,
        scans_limit: parseInt(document.getElementById('share-scans-limit').value),
        valid_days: parseInt(document.getElementById('share-valid-days').value)
      };
      
      try {
        const response = await fetch('/api/admin/share-links/create', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'x-admin-key': localStorage.getItem('admin_id')
          },
          body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (data.success) {
          alert('Share link created! URL copied to clipboard.');
          navigator.clipboard.writeText(data.share_url);
          closeModal('modal-create-share-link');
          loadShareLinks();
        } else {
          alert('Error: ' + data.error);
        }
      } catch (error) {
        console.error('Error creating share link:', error);
        alert('Failed to create share link');
      }
    }

    function copyShareUrl(url) {
      navigator.clipboard.writeText(url);
      alert('URL copied to clipboard!');
    }

    async function deleteShareLink(code) {
      if (!confirm('Delete this share link?')) return;
      
      try {
        const response = await fetch(`/api/admin/share-links/${code}`, {
          method: 'DELETE',
          headers: { 'x-admin-key': localStorage.getItem('admin_id') }
        });
        
        const data = await response.json();
        
        if (data.success) {
          alert('Share link deleted!');
          loadShareLinks();
        } else {
          alert('Error: ' + data.error);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Failed to delete share link');
      }
    }

    // ==========================================
    // LEADERBOARD TAB
    // ==========================================
    async function loadLeaderboard() {
      try {
        const response = await fetch('/api/admin/leaderboard', {
          headers: { 'x-admin-key': localStorage.getItem('admin_id') }
        });
        
        const data = await response.json();
        
        if (data.success) {
          displayLeaderboardResults(data.entries);
        }
      } catch (error) {
        console.error('Error loading leaderboard:', error);
      }
    }

    async function searchLeaderboard() {
      const query = document.getElementById('leaderboard-search').value;
      
      if (!query) {
        loadLeaderboard();
        return;
      }
      
      try {
        const response = await fetch(`/api/admin/leaderboard/search?q=${encodeURIComponent(query)}`, {
          headers: { 'x-admin-key': localStorage.getItem('admin_id') }
        });
        
        const data = await response.json();
        
        if (data.success) {
          displayLeaderboardResults(data.entries);
        }
      } catch (error) {
        console.error('Error searching leaderboard:', error);
      }
    }

    function displayLeaderboardResults(entries) {
      const tbody = document.getElementById('leaderboard-tbody');
      tbody.innerHTML = '';
      
      entries.forEach(entry => {
        const medals = ['ü•á', 'ü•à', 'ü•â'];
        const medal = entry.rank <= 3 ? medals[entry.rank - 1] : '';
        
        const row = `
          <tr>
            <td class="px-4 py-3 font-bold">${medal} #${entry.rank}</td>
            <td class="px-4 py-3">${entry.company_name || '-'}</td>
            <td class="px-4 py-3 text-blue-400 text-sm">${entry.url.substring(0, 50)}...</td>
            <td class="px-4 py-3 font-bold">${entry.score}/100</td>
            <td class="px-4 py-3">${entry.country}</td>
            <td class="px-4 py-3">
              <button onclick="deleteLeaderboardEntry(${entry.id})" class="text-red-400 hover:text-red-300">üóëÔ∏è Delete</button>
            </td>
          </tr>
        `;
        tbody.innerHTML += row;
      });
    }

    async function deleteLeaderboardEntry(id) {
      if (!confirm('Delete this leaderboard entry?')) return;
      
      try {
        const response = await fetch(`/api/admin/leaderboard/${id}`, {
          method: 'DELETE',
          headers: { 'x-admin-key': localStorage.getItem('admin_id') }
        });
        
        const data = await response.json();
        
        if (data.success) {
          alert('Entry deleted!');
          loadLeaderboard();
        } else {
          alert('Error: ' + data.error);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Failed to delete entry');
      }
    }

    async function scanAllAgencies() {
      if (!confirm('This will scan all agencies and add them to the leaderboard. Continue?')) return;
      
      alert('Scanning started! This may take a few minutes...');
      
      try {
        const response = await fetch('/api/admin/scan-all-agencies', {
          method: 'POST',
          headers: { 'x-admin-key': localStorage.getItem('admin_id') }
        });
        
        const data = await response.json();
        
        if (data.success) {
          alert(`Scan complete!\nSuccess: ${data.successCount}\nFailed: ${data.failCount}`);
          loadLeaderboard();
        } else {
          alert('Error: ' + data.error);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Scan failed');
      }
    }

    // ==========================================
    // MODAL HELPERS
    // ==========================================
    function showAddAgencyModal() {
      document.getElementById('modal-add-agency').classList.remove('hidden');
    }

    function showCreateShareLinkModal() {
      document.getElementById('modal-create-share-link').classList.remove('hidden');
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.add('hidden');
    }
  </script>
</body>
</html>
