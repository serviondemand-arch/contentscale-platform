<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SEO ContentScore - Free Analysis Tool</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    .calc-breakdown { display: none; }
    .calc-breakdown.open { display: block; }
    .score-formula { 
      font-family: 'Courier New', monospace; 
      background: #1f2937; 
      padding: 8px; 
      border-radius: 4px;
      margin: 4px 0;
    }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">

  <!-- HEADER -->
  <div class="bg-gray-800 border-b border-gray-700 px-6 py-4">
    <div class="container mx-auto">
      <h1 class="text-3xl font-bold text-blue-400">üìä SEO ContentScore</h1>
      <p class="text-gray-400 text-sm">Analyze your website for AI-era SEO optimization</p>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <div class="container mx-auto px-6 py-8 max-w-6xl">
    
    <!-- SCAN FORM -->
    <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 mb-6">
      <h2 class="text-2xl font-bold mb-4">üîç Free Website Analysis</h2>
      
      <form id="scan-form" onsubmit="submitScan(event)">
        <div class="mb-4">
          <label class="block text-sm text-gray-400 mb-2">Website URL *</label>
          <input 
            type="url" 
            id="scan-url"
            required
            class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:border-blue-500 focus:outline-none text-lg"
            placeholder="https://example.com">
          <p class="text-xs text-gray-500 mt-2">
            üí° Enter your full website URL (including https://)
          </p>
        </div>

        <button 
          type="submit"
          id="scan-submit"
          class="w-full bg-blue-600 hover:bg-blue-700 py-4 rounded-lg font-bold text-lg transition">
          üîç Analyze Website
        </button>

        <div class="mt-4 p-3 bg-gray-700 rounded-lg">
          <p class="text-xs text-gray-400">
            ‚ö° We'll automatically fetch and analyze your page HTML, including all schemas, meta tags, and content structure.
          </p>
        </div>
      </form>
    </div>

    <!-- RESULT AREA -->
    <div id="scan-result" class="hidden"></div>

    <!-- FEATURES -->
    <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
      <h3 class="text-xl font-bold mb-4">‚ú® What We Analyze</h3>
      <div class="grid md:grid-cols-3 gap-4">
        <div class="flex items-start gap-3">
          <div class="text-2xl">üìÑ</div>
          <div>
            <h4 class="font-bold">Content Quality</h4>
            <p class="text-sm text-gray-400">Word count, readability, structure</p>
          </div>
        </div>
        <div class="flex items-start gap-3">
          <div class="text-2xl">üîç</div>
          <div>
            <h4 class="font-bold">Schema Markup</h4>
            <p class="text-sm text-gray-400">JSON-LD, microdata validation</p>
          </div>
        </div>
        <div class="flex items-start gap-3">
          <div class="text-2xl">ü§ñ</div>
          <div>
            <h4 class="font-bold">AI Overview Ready</h4>
            <p class="text-sm text-gray-400">Google AI features optimization</p>
          </div>
        </div>
        <div class="flex items-start gap-3">
          <div class="text-2xl">üìä</div>
          <div>
            <h4 class="font-bold">Technical SEO</h4>
            <p class="text-sm text-gray-400">Meta tags, Open Graph</p>
          </div>
        </div>
        <div class="flex items-start gap-3">
          <div class="text-2xl">üéØ</div>
          <div>
            <h4 class="font-bold">GRAAF Framework</h4>
            <p class="text-sm text-gray-400">Credibility & accuracy</p>
          </div>
        </div>
        <div class="flex items-start gap-3">
          <div class="text-2xl">‚ö°</div>
          <div>
            <h4 class="font-bold">CRAFT Score</h4>
            <p class="text-sm text-gray-400">Content quality metrics</p>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script>
    let currentScanData = null;
    let currentShareId = null;

    async function submitScan(event) {
      event.preventDefault();
      
      const submitBtn = document.getElementById('scan-submit');
      const resultDiv = document.getElementById('scan-result');
      
      const url = document.getElementById('scan-url').value.trim();
      
      if (!url) {
        showError('Please provide a valid URL');
        return;
      }

      if (!url.startsWith('http://') && !url.startsWith('https://')) {
        showError('URL must start with https:// or http://');
        return;
      }
      
      submitBtn.disabled = true;
      submitBtn.textContent = '‚è≥ Fetching & Analyzing...';
      resultDiv.classList.add('hidden');
      
      try {
        console.log('üîç Scanning URL:', url);
        
        const response = await fetch('/api/scan-free', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ url })
        });
        
        console.log('üì° Response status:', response.status);
        
        const contentType = response.headers.get('content-type');
        
        if (!contentType || !contentType.includes('application/json')) {
          const text = await response.text();
          console.error('‚ùå Non-JSON response:', text.substring(0, 500));
          throw new Error('Server error: Invalid response format');
        }
        
        const data = await response.json();
        console.log('‚úÖ Scan result:', data);
        
        if (!data.success) {
          throw new Error(data.error || 'Scan failed');
        }
        
        currentScanData = data;
        currentShareId = data.share_id || generateShareId();
        
        showSuccess(data);
        incrementScanCounter();
        
      } catch (error) {
        console.error('‚ùå Scan error:', error);
        showError(error.message);
        
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'üîç Analyze Website';
      }
    }

    function showSuccess(data) {
      const resultDiv = document.getElementById('scan-result');
      const score = Math.round(data.score || 0);
      
      let qualityColor = 'text-red-400';
      let qualityLabel = 'Needs Improvement';
      let qualityBg = 'bg-red-900';
      
      if (score >= 90) {
        qualityColor = 'text-green-400';
        qualityLabel = 'Excellent';
        qualityBg = 'bg-green-900';
      } else if (score >= 80) {
        qualityColor = 'text-blue-400';
        qualityLabel = 'Good';
        qualityBg = 'bg-blue-900';
      } else if (score >= 70) {
        qualityColor = 'text-yellow-400';
        qualityLabel = 'Average';
        qualityBg = 'bg-yellow-900';
      } else if (score >= 60) {
        qualityColor = 'text-orange-400';
        qualityLabel = 'Below Average';
        qualityBg = 'bg-orange-900';
      }

      const recommendations = generateRecommendations(data);
      const wordCount = data.wordCount || 0;
      
      const breakdownHtml = generateBreakdownHTML(data);
      
      resultDiv.className = 'bg-gray-800 rounded-lg p-6 border border-gray-700';
      resultDiv.innerHTML = `
        <!-- Action Buttons -->
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-2xl font-bold">‚úÖ Analysis Complete!</h3>
          <div class="flex gap-2">
            <button onclick="exportDetailedPDF()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg font-bold text-sm transition">
              üìÑ Export Detailed PDF
            </button>
            <button onclick="copyShareLink()" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg font-bold text-sm transition">
              üîó Share Link
            </button>
          </div>
        </div>
        
        <!-- Score Card -->
        <div class="${qualityBg} rounded-lg p-8 mb-6 text-center border border-gray-600">
          <div class="text-7xl font-bold ${qualityColor} mb-3">${score}<span class="text-4xl">/100</span></div>
          <div class="text-2xl font-bold mb-2">${qualityLabel}</div>
          <div class="text-sm text-gray-400">${data.quality || ''}</div>
        </div>

        <!-- Scoring Breakdown with Calculations -->
        ${breakdownHtml}

        <!-- Details -->
        <div class="grid md:grid-cols-2 gap-4 mb-6">
          <div class="bg-gray-700 rounded-lg p-4">
            <div class="text-sm text-gray-400 mb-1">Analyzed URL</div>
            <a href="${data.url}" target="_blank" class="text-blue-400 hover:text-blue-300 text-sm break-all">
              ${data.url}
            </a>
          </div>
          
          <div class="bg-gray-700 rounded-lg p-4">
            <div class="text-sm text-gray-400 mb-1">Words Analyzed</div>
            <div class="text-xl font-bold text-blue-600">${wordCount.toLocaleString()}</div>
          </div>

          <div class="bg-gray-700 rounded-lg p-4">
            <div class="text-sm text-gray-400 mb-1">Analyzed at</div>
            <div class="text-sm">${new Date(data.timestamp).toLocaleString()}</div>
          </div>

          <div class="bg-gray-700 rounded-lg p-4">
            <div class="text-sm text-gray-400 mb-1">Share ID</div>
            <div class="text-sm font-mono">${currentShareId}</div>
          </div>
        </div>

        <!-- RECOMMENDATIONS WITH CALCULATIONS -->
        <div class="bg-gradient-to-r from-blue-900 to-purple-900 rounded-lg p-6 mb-6 border border-blue-700">
          <h3 class="text-2xl font-bold mb-4">üéØ Recommendations to Reach 95+ (with Calculations)</h3>
          <div class="space-y-4">
            ${recommendations.critical.length > 0 ? `
              <div>
                <h4 class="font-bold text-red-400 mb-2">üî¥ Critical Issues (Fix First)</h4>
                <ul class="space-y-3">
                  ${recommendations.critical.map(rec => `
                    <li class="bg-gray-800 rounded p-3">
                      <div class="flex items-start gap-2">
                        <span class="text-red-400 mt-1">‚ñ∂</span>
                        <div class="flex-1">
                          <div class="text-sm mb-1">${rec.text}</div>
                          ${rec.calculation ? `
                            <div class="text-xs text-gray-400 mt-2">
                              <button onclick="toggleCalc('calc-${rec.id}')" class="text-blue-400 hover:text-blue-300">
                                üîç Show Calculation ‚ñº
                              </button>
                              <div id="calc-${rec.id}" class="calc-breakdown mt-2 p-2 bg-gray-900 rounded">
                                <div class="font-bold text-yellow-400 mb-1">üí° Impact: ${rec.impact}</div>
                                <div class="score-formula">${rec.calculation}</div>
                                <div class="text-green-400 mt-1">‚ö° ${rec.solution}</div>
                              </div>
                            </div>
                          ` : ''}
                        </div>
                      </div>
                    </li>
                  `).join('')}
                </ul>
              </div>
            ` : ''}
            
            ${recommendations.important.length > 0 ? `
              <div>
                <h4 class="font-bold text-yellow-400 mb-2">üü° Important Improvements</h4>
                <ul class="space-y-3">
                  ${recommendations.important.map(rec => `
                    <li class="bg-gray-800 rounded p-3">
                      <div class="flex items-start gap-2">
                        <span class="text-yellow-400 mt-1">‚ñ∂</span>
                        <div class="flex-1">
                          <div class="text-sm mb-1">${rec.text}</div>
                          ${rec.calculation ? `
                            <div class="text-xs text-gray-400 mt-2">
                              <button onclick="toggleCalc('calc-${rec.id}')" class="text-blue-400 hover:text-blue-300">
                                üîç Show Calculation ‚ñº
                              </button>
                              <div id="calc-${rec.id}" class="calc-breakdown mt-2 p-2 bg-gray-900 rounded">
                                <div class="font-bold text-yellow-400 mb-1">üí° Impact: ${rec.impact}</div>
                                <div class="score-formula">${rec.calculation}</div>
                                <div class="text-green-400 mt-1">‚ö° ${rec.solution}</div>
                              </div>
                            </div>
                          ` : ''}
                        </div>
                      </div>
                    </li>
                  `).join('')}
                </ul>
              </div>
            ` : ''}
            
            ${recommendations.nice_to_have.length > 0 ? `
              <div>
                <h4 class="font-bold text-green-400 mb-2">üü¢ Nice to Have</h4>
                <ul class="space-y-2">
                  ${recommendations.nice_to_have.map(rec => `
                    <li class="flex items-start gap-2">
                      <span class="text-green-400 mt-1">‚ñ∂</span>
                      <span class="text-sm">${typeof rec === 'string' ? rec : rec.text}</span>
                    </li>
                  `).join('')}
                </ul>
              </div>
            ` : ''}
          </div>
        </div>

        <!-- CTA -->
        <div class="p-6 bg-gradient-to-r from-green-900 to-blue-900 border border-green-700 rounded-lg">
          <h4 class="font-bold text-xl mb-2">üöÄ Need Expert Help?</h4>
          <p class="text-sm text-gray-300 mb-4">Get personalized SEO optimization and reach 95+ score faster.</p>
          <div class="flex flex-wrap gap-3">
            <a href="https://contentscale.site/contact" target="_blank" class="inline-block bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg font-bold transition">
              üìû Contact Us
            </a>
            <a href="https://wa.me/31628073996" target="_blank" class="inline-block bg-green-600 hover:bg-green-700 px-6 py-3 rounded-lg font-bold transition">
              üí¨ WhatsApp
            </a>
            <a href="mailto:info@contentscale.site" class="inline-block bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded-lg font-bold transition">
              ‚úâÔ∏è Email
            </a>
          </div>
        </div>
      `;
      
      resultDiv.classList.remove('hidden');
      resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    function generateBreakdownHTML(data) {
      const breakdown = data.breakdown || {};
      
      return `
        <div class="mb-6">
          <h4 class="text-xl font-bold mb-4">üìä Detailed Score Breakdown</h4>
          
          <!-- GRAAF Framework -->
          <div class="bg-gray-700 rounded-lg p-4 mb-4">
            <div class="flex justify-between items-center mb-2 cursor-pointer" onclick="toggleCalc('graaf-breakdown')">
              <h5 class="font-bold text-blue-400">üéØ GRAAF Framework</h5>
              <div class="text-2xl font-bold">${Math.round(breakdown.graaf?.total || 0)}/50</div>
            </div>
            <div id="graaf-breakdown" class="calc-breakdown">
              <div class="space-y-2 mt-3 text-sm">
                <div class="flex justify-between p-2 bg-gray-800 rounded">
                  <span>Credibility (expert quotes, statistics, sources)</span>
                  <span class="font-bold">${Math.round(breakdown.graaf?.credibility || 0)}/10</span>
                </div>
                <div class="flex justify-between p-2 bg-gray-800 rounded">
                  <span>Relevance (keyword optimization, search intent)</span>
                  <span class="font-bold">${Math.round(breakdown.graaf?.relevance || 0)}/10</span>
                </div>
                <div class="flex justify-between p-2 bg-gray-800 rounded">
                  <span>Actionability (step-by-step, examples, CTAs)</span>
                  <span class="font-bold">${Math.round(breakdown.graaf?.actionability || 0)}/10</span>
                </div>
                <div class="flex justify-between p-2 bg-gray-800 rounded">
                  <span>Accuracy (data citations, case studies, sources)</span>
                  <span class="font-bold">${Math.round(breakdown.graaf?.accuracy || 0)}/10</span>
                </div>
                <div class="flex justify-between p-2 bg-gray-800 rounded">
                  <span>Freshness (recent updates, current year mentions)</span>
                  <span class="font-bold">${Math.round(breakdown.graaf?.freshness || 0)}/10</span>
                </div>
              </div>
            </div>
          </div>

          <!-- CRAFT Framework -->
          <div class="bg-gray-700 rounded-lg p-4 mb-4">
            <div class="flex justify-between items-center mb-2 cursor-pointer" onclick="toggleCalc('craft-breakdown')">
              <h5 class="font-bold text-purple-400">‚ö° CRAFT Framework</h5>
              <div class="text-2xl font-bold">${Math.round(breakdown.craft?.total || 0)}/30</div>
            </div>
            <div id="craft-breakdown" class="calc-breakdown">
              <div class="space-y-2 mt-3 text-sm">
                <div class="flex justify-between p-2 bg-gray-800 rounded">
                  <span>Cut Fluff (readability, sentence length)</span>
                  <span class="font-bold">${Math.round(breakdown.craft?.cutFluff || 0)}/8</span>
                </div>
                <div class="flex justify-between p-2 bg-gray-800 rounded">
                  <span>Review & Optimize (meta tags, heading hierarchy)</span>
                  <span class="font-bold">${Math.round(breakdown.craft?.reviewOptimize || 0)}/8</span>
                </div>
                <div class="flex justify-between p-2 bg-gray-800 rounded">
                  <span>Add Visuals (images, tables, lists, videos)</span>
                  <span class="font-bold">${Math.round(breakdown.craft?.addVisuals || 0)}/6</span>
                </div>
                <div class="flex justify-between p-2 bg-gray-800 rounded">
                  <span>FAQ Integration (count, quality, schema)</span>
                  <span class="font-bold">${Math.round(breakdown.craft?.faqIntegration || 0)}/4</span>
                </div>
                <div class="flex justify-between p-2 bg-gray-800 rounded">
                  <span>Trust Building (author bio, testimonials)</span>
                  <span class="font-bold">${Math.round(breakdown.craft?.trustBuilding || 0)}/4</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Technical SEO -->
          <div class="bg-gray-700 rounded-lg p-4">
            <div class="flex justify-between items-center mb-2 cursor-pointer" onclick="toggleCalc('technical-breakdown')">
              <h5 class="font-bold text-green-400">üîß Technical SEO</h5>
              <div class="text-2xl font-bold">${Math.round(breakdown.technical?.total || 0)}/20</div>
            </div>
            <div id="technical-breakdown" class="calc-breakdown">
              <div class="space-y-2 mt-3 text-sm">
                <div class="flex justify-between p-2 bg-gray-800 rounded">
                  <span>Meta Optimization (title, description lengths)</span>
                  <span class="font-bold">${Math.round(breakdown.technical?.metaOptimization || 0)}/4</span>
                </div>
                <div class="flex justify-between p-2 bg-gray-800 rounded">
                  <span>Schema Markup (Article, FAQ, HowTo, etc.)</span>
                  <span class="font-bold">${Math.round(breakdown.technical?.schemaMarkup || 0)}/4</span>
                </div>
                <div class="flex justify-between p-2 bg-gray-800 rounded">
                  <span>Internal Linking (contextual links)</span>
                  <span class="font-bold">${Math.round(breakdown.technical?.internalLinking || 0)}/4</span>
                </div>
                <div class="flex justify-between p-2 bg-gray-800 rounded">
                  <span>Page Structure (headings, word count)</span>
                  <span class="font-bold">${Math.round(breakdown.technical?.pageStructure || 0)}/4</span>
                </div>
                <div class="flex justify-between p-2 bg-gray-800 rounded">
                  <span>Mobile Optimization (responsive, alt texts)</span>
                  <span class="font-bold">${Math.round(breakdown.technical?.mobileOptimization || 0)}/4</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function toggleCalc(id) {
      const el = document.getElementById(id);
      if (el) {
        el.classList.toggle('open');
      }
    }

    function generateRecommendations(data) {
      const score = data.score || 0;
      const breakdown = data.breakdown || {};
      const wordCount = data.wordCount || 0;
      
      const recommendations = {
        critical: [],
        important: [],
        nice_to_have: []
      };

      let recId = 0;

      // Schema Markup
      const schemaScore = breakdown.technical?.schemaMarkup || 0;
      if (schemaScore < 4) {
        recommendations.critical.push({
          id: recId++,
          text: 'Add schema markup (JSON-LD) for better AI Overview visibility',
          impact: '+4 points',
          calculation: `Current: ${schemaScore}/4 points
‚Ä¢ Article schema ‚Üí 2 points
‚Ä¢ Specialized schema (FAQ/HowTo) ‚Üí 2 points
Formula: Article (2pts) + Specialized (2pts) = 4 total`,
          solution: 'Add <script type="application/ld+json"> with Article and FAQPage schemas'
        });
      }

      // Meta Description
      const metaScore = breakdown.technical?.metaOptimization || 0;
      if (metaScore < 4) {
        recommendations.critical.push({
          id: recId++,
          text: 'Optimize meta description (150-160 characters optimal)',
          impact: '+1 point',
          calculation: `Current: ${metaScore}/4 points
‚Ä¢ Title 50-60 chars ‚Üí 2 points
‚Ä¢ Description 150-160 chars ‚Üí 2 points
Formula: Optimal length = max points`,
          solution: 'Expand meta description to 155 characters with key benefits'
        });
      }

      // Word Count
      if (wordCount < 800) {
        recommendations.critical.push({
          id: recId++,
          text: `Increase content length to 1200+ words (currently ${wordCount} words)`,
          impact: '+1-3 points',
          calculation: `Current word count: ${wordCount}
‚Ä¢ <800 words ‚Üí 0 points
‚Ä¢ 800-1200 words ‚Üí +1 point (important)
‚Ä¢ 1200-1500 words ‚Üí +2 points
‚Ä¢ 1500+ words ‚Üí +3 points (GRAAF + Page Structure)
Formula: More comprehensive content = higher scores`,
          solution: 'Add more examples, case studies, and actionable steps'
        });
      } else if (wordCount < 1200) {
        recommendations.important.push({
          id: recId++,
          text: `Consider expanding content to 1500+ words for better coverage (currently ${wordCount} words)`,
          impact: '+1-2 points',
          calculation: `Current: ${wordCount} words = moderate depth
‚Ä¢ 1500+ words ‚Üí Page Structure bonus
‚Ä¢ More content ‚Üí Better GRAAF scores
Formula: Depth = Word Count √ó Content Quality`,
          solution: 'Add detailed explanations and more visual content'
        });
      }

      // GRAAF improvements
      const graafScore = breakdown.graaf?.total || 0;
      if (graafScore < 45) {
        recommendations.important.push({
          id: recId++,
          text: 'Strengthen your content credibility with more authoritative sources',
          impact: '+2-3 points',
          calculation: `Current GRAAF: ${graafScore}/50
Credibility scoring:
‚Ä¢ 1 source ‚Üí 1 point
‚Ä¢ 3 sources ‚Üí 2 points  
‚Ä¢ 5+ sources ‚Üí 3 points
Formula: More authoritative citations = higher credibility`,
          solution: 'Add 2-3 peer-reviewed sources or industry reports'
        });
      }

      // Point Gap
      if (score < 95) {
        const pointsNeeded = 95 - score;
        recommendations.important.push({
          id: recId++,
          text: `You need ${pointsNeeded} more points to reach 95+ score`,
          impact: `Target: +${pointsNeeded} points`,
          calculation: `Current: ${score}/100
Target: 95/100
Gap: ${pointsNeeded} points

Priority fixes for maximum impact:
1. Schema markup ‚Üí +4 points
2. Word count expansion ‚Üí +2-3 points
3. Meta optimization ‚Üí +1-2 points
4. Visual content ‚Üí +1-2 points

Formula: Fix highest-impact items first`,
          solution: 'Focus on Critical Issues first, then Important Improvements'
        });
      }

      // Nice to have
      recommendations.nice_to_have.push('Add FAQ schema for common questions in your content');
      recommendations.nice_to_have.push('Include internal links to related content on your site');
      recommendations.nice_to_have.push('Optimize images with descriptive alt text and proper compression');
      recommendations.nice_to_have.push('Add video content or rich media to increase engagement');

      return recommendations;
    }

    async function exportDetailedPDF() {
      if (!currentScanData) {
        alert('No scan data available');
        return;
      }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      const score = Math.round(currentScanData.score || 0);
      const url = currentScanData.url || '';
      const timestamp = new Date(currentScanData.timestamp).toLocaleString();
      const wordCount = currentScanData.wordCount || 0;
      const breakdown = currentScanData.breakdown || {};
      const audit = currentScanData.audit || {};
      
      let yPos = 20;
      const pageHeight = 280;
      const leftMargin = 20;
      const rightMargin = 190;
      
      // Helper function to check if we need a new page
      function checkNewPage(neededSpace = 10) {
        if (yPos + neededSpace > pageHeight) {
          doc.addPage();
          yPos = 20;
          return true;
        }
        return false;
      }
      
      // Helper function to add section header
      function addSectionHeader(title, color = [66, 133, 244]) {
        checkNewPage(15);
        doc.setFontSize(14);
        doc.setTextColor(...color);
        doc.text(title, leftMargin, yPos);
        yPos += 7;
      }
      
      // Helper function to add calculation box
      function addCalculationBox(label, current, max, formula, details = []) {
        checkNewPage(25);
        
        // Background box
        doc.setFillColor(245, 245, 245);
        doc.rect(leftMargin, yPos - 4, rightMargin - leftMargin, details.length * 4 + 12, 'F');
        
        // Score line
        doc.setFontSize(10);
        doc.setTextColor(0, 0, 0);
        doc.setFont(undefined, 'bold');
        doc.text(`${label}: ${current}/${max} points`, leftMargin + 2, yPos);
        yPos += 5;
        
        // Formula
        doc.setFont(undefined, 'normal');
        doc.setFontSize(8);
        doc.setTextColor(80, 80, 80);
        if (formula) {
          const formulaLines = doc.splitTextToSize(`Formula: ${formula}`, rightMargin - leftMargin - 4);
          formulaLines.forEach(line => {
            doc.text(line, leftMargin + 2, yPos);
            yPos += 3.5;
          });
        }
        
        // Details
        if (details.length > 0) {
          doc.setTextColor(100, 100, 100);
          details.forEach(detail => {
            const detailLines = doc.splitTextToSize(detail, rightMargin - leftMargin - 4);
            detailLines.forEach(line => {
              doc.text(line, leftMargin + 4, yPos);
              yPos += 3.5;
            });
          });
        }
        
        yPos += 4;
      }
      
      // ==================== PAGE 1: OVERVIEW ====================
      
      // Title
      doc.setFontSize(20);
      doc.setTextColor(66, 133, 244);
      doc.text('SEO ContentScore', leftMargin, yPos);
      yPos += 8;
      
      doc.setFontSize(14);
      doc.setTextColor(100, 100, 100);
      doc.text('Detailed Analysis Report with Calculations', leftMargin, yPos);
      yPos += 12;
      
      // Score Circle
      doc.setFontSize(48);
      const scoreColor = score >= 90 ? [34, 197, 94] : score >= 70 ? [244, 180, 67] : [244, 67, 54];
      doc.setTextColor(...scoreColor);
      doc.text(`${score}`, leftMargin, yPos);
      
      doc.setFontSize(20);
      doc.setTextColor(150, 150, 150);
      doc.text('/100', leftMargin + 25, yPos);
      yPos += 12;
      
      // Meta info
      doc.setFontSize(9);
      doc.setTextColor(100, 100, 100);
      const urlLines = doc.splitTextToSize(`URL: ${url}`, rightMargin - leftMargin);
      urlLines.forEach(line => {
        doc.text(line, leftMargin, yPos);
        yPos += 4;
      });
      doc.text(`Words: ${wordCount.toLocaleString()} | Analyzed: ${timestamp}`, leftMargin, yPos);
      yPos += 10;
      
      // Overall Calculation
      addSectionHeader('Score Calculation Overview', [66, 133, 244]);
      doc.setFontSize(9);
      doc.setTextColor(0, 0, 0);
      
      const overallCalc = [
        `GRAAF Framework: ${Math.round(breakdown.graaf?.total || 0)}/50 points`,
        `CRAFT Framework: ${Math.round(breakdown.craft?.total || 0)}/30 points`,
        `Technical SEO: ${Math.round(breakdown.technical?.total || 0)}/20 points`,
        `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`,
        `TOTAL SCORE: ${score}/100 points`,
      ];
      
      overallCalc.forEach(line => {
        if (line.includes('‚îÅ‚îÅ‚îÅ')) {
          doc.setTextColor(200, 200, 200);
        } else if (line.includes('TOTAL')) {
          doc.setFont(undefined, 'bold');
          doc.setTextColor(...scoreColor);
        } else {
          doc.setFont(undefined, 'normal');
          doc.setTextColor(0, 0, 0);
        }
        doc.text(line, leftMargin + 5, yPos);
        yPos += 4;
      });
      yPos += 5;
      
      // ==================== PAGE 2: GRAAF FRAMEWORK ====================
      
      doc.addPage();
      yPos = 20;
      
      addSectionHeader('GRAAF Framework Breakdown (50 points)', [59, 130, 246]);
      
      doc.setFontSize(8);
      doc.setTextColor(80, 80, 80);
      doc.text('GRAAF = Genuinely Credible + Relevance + Actionability + Accuracy + Freshness', leftMargin, yPos);
      yPos += 7;
      
      // Credibility
      addCalculationBox(
        'Credibility',
        Math.round(breakdown.graaf?.credibility || 0),
        10,
        'Expert Quotes (0-4pts) + Statistics (0-3pts) + Sources (0-3pts)',
        [
          `‚Ä¢ Expert quotes found: ${audit.expertQuotes || 0} ‚Üí ${audit.expertQuotes >= 3 ? '4pts' : audit.expertQuotes >= 2 ? '3pts' : audit.expertQuotes >= 1 ? '2pts' : '0pts'}`,
          `  (Optimal: 3+ quotes = 4 points)`,
          `‚Ä¢ Statistics found: ${audit.statistics || 0} ‚Üí ${audit.statistics >= 10 ? '3pts' : audit.statistics >= 5 ? '2pts' : audit.statistics >= 3 ? '1pt' : '0pts'}`,
          `  (Optimal: 10+ statistics = 3 points)`,
          `‚Ä¢ Sources cited: ${audit.sources || 0} ‚Üí ${audit.sources >= 5 ? '3pts' : audit.sources >= 3 ? '2pts' : audit.sources >= 1 ? '1pt' : '0pts'}`,
          `  (Optimal: 5+ authoritative sources = 3 points)`,
        ]
      );
      
      // Relevance
      addCalculationBox(
        'Relevance',
        Math.round(breakdown.graaf?.relevance || 0),
        10,
        'Keyword in Title (0-3pts) + Keyword in First 100 words (0-3pts) + Keyword Density (0-3pts) + LSI (0-1pt)',
        [
          `‚Ä¢ Keyword in title: ${audit.keywordInTitle || 0} points`,
          `‚Ä¢ Keyword in first 100 words: ${audit.keywordInFirst100 || 0} points`,
          `‚Ä¢ Keyword density: ${audit.keywordDensity || 0} points (optimal: 1-2%)`,
          `‚Ä¢ LSI keywords found: ${audit.lsiKeywords || 0} (need 5+ for bonus point)`,
        ]
      );
      
      // Actionability
      addCalculationBox(
        'Actionability',
        Math.round(breakdown.graaf?.actionability || 0),
        10,
        'Step-by-Step (0-3pts) + Examples (0-3pts) + CTAs (0-3pts) + Tools (0-1pt)',
        [
          `‚Ä¢ Step-by-step instructions: ${audit.stepByStep || 0} points`,
          `‚Ä¢ Concrete examples: ${audit.examplesCount || 0} found ‚Üí ${audit.examplesCount >= 5 ? '3pts' : audit.examplesCount >= 3 ? '2pts' : audit.examplesCount >= 1 ? '1pt' : '0pts'}`,
          `‚Ä¢ Clear CTAs present: ${audit.ctaPresent || 0} points`,
          `‚Ä¢ Tools/resources mentioned: ${audit.toolsResources || 0} point`,
        ]
      );
      
      // Accuracy
      addCalculationBox(
        'Accuracy',
        Math.round(breakdown.graaf?.accuracy || 0),
        10,
        'Data Citations (0-3pts) + Case Studies (0-3pts) + Fact Sources (0-2pts) + Pub Date (0-2pts)',
        [
          `‚Ä¢ Data citations: ${audit.dataCitations || 0} found ‚Üí ${audit.dataCitations >= 5 ? '3pts' : audit.dataCitations >= 3 ? '2pts' : audit.dataCitations >= 1 ? '1pt' : '0pts'}`,
          `‚Ä¢ Case studies: ${audit.caseStudies || 0} found ‚Üí ${audit.caseStudies >= 2 ? '3pts' : audit.caseStudies >= 1 ? '2pts' : '0pts'}`,
          `‚Ä¢ Fact sources: ${audit.factSources || 0} found ‚Üí ${audit.factSources >= 3 ? '2pts' : audit.factSources >= 1 ? '1pt' : '0pts'}`,
          `‚Ä¢ Publication date: ${audit.publicationDate ? '2pts' : '0pts'} (shows content maintenance)`,
        ]
      );
      
      // Freshness
      addCalculationBox(
        'Freshness',
        Math.round(breakdown.graaf?.freshness || 0),
        10,
        'Recent Updates (0-3pts) + Current Year (0-3pts) + Data Recency (0-3pts) + Trending (0-1pt)',
        [
          `‚Ä¢ Recent updates: ${audit.recentUpdates || 0} points (based on last modified date)`,
          `‚Ä¢ Current year mentions: ${audit.currentYearMentions || 0} points`,
          `‚Ä¢ Data recency: ${audit.dataRecency || 0} points (2023-2025 mentions)`,
          `‚Ä¢ Trending topics: ${audit.trendingTopics || 0} point (AI, SGE mentions)`,
        ]
      );
      
      // ==================== PAGE 3: CRAFT FRAMEWORK ====================
      
      doc.addPage();
      yPos = 20;
      
      addSectionHeader('CRAFT Framework Breakdown (30 points)', [168, 85, 247]);
      
      doc.setFontSize(8);
      doc.setTextColor(80, 80, 80);
      doc.text('CRAFT = Cut Fluff + Review & Optimize + Add Visuals + FAQ Integration + Trust Building', leftMargin, yPos);
      yPos += 7;
      
      // Cut Fluff
      addCalculationBox(
        'Cut Fluff',
        Math.round(breakdown.craft?.cutFluff || 0),
        8,
        'Readability (0-3pts) + Sentence Length (0-2pts) + Paragraph Length (0-3pts)',
        [
          `‚Ä¢ Readability score: ${audit.readabilityScore || 0} (Flesch Reading Ease)`,
          `  ‚Üí ${audit.readabilityScore >= 60 && audit.readabilityScore <= 70 ? '3pts (optimal)' : '1-2pts'}`,
          `‚Ä¢ Average sentence length: ${audit.avgSentenceLength || 0} points`,
          `  (Optimal: 15-20 words per sentence)`,
          `‚Ä¢ Average paragraph length: ${audit.avgParagraphLength || 0} words`,
          `  Paragraphs >150 words: ${audit.paragraphsOver150Words || 0}`,
          `  (Optimal: 50-100 words avg, <3 long paragraphs)`,
        ]
      );
      
      // Review & Optimize
      addCalculationBox(
        'Review & Optimize',
        Math.round(breakdown.craft?.reviewOptimize || 0),
        8,
        'Meta Title (0-2pts) + Meta Description (0-2pts) + Heading Hierarchy (0-3pts) + TOC (0-1pt)',
        [
          `‚Ä¢ Meta title length: ${audit.metaTitleLength || 0} chars ‚Üí ${audit.metaTitleLength >= 50 && audit.metaTitleLength <= 60 ? '2pts' : audit.metaTitleLength >= 40 && audit.metaTitleLength <= 70 ? '1pt' : '0pts'}`,
          `  (Optimal: 50-60 characters)`,
          `‚Ä¢ Meta description: ${audit.metaDescLength || 0} chars ‚Üí ${audit.metaDescLength >= 150 && audit.metaDescLength <= 160 ? '2pts' : audit.metaDescLength >= 120 && audit.metaDescLength <= 180 ? '1pt' : '0pts'}`,
          `  (Optimal: 150-160 characters)`,
          `‚Ä¢ Heading structure: ${audit.headingHierarchy || 0} points`,
          `  H1: ${audit.headingCount?.h1 || 0}, H2: ${audit.headingCount?.h2 || 0}, H3: ${audit.headingCount?.h3 || 0}`,
          `  (Optimal: 1 H1, 3+ H2s, H3s under H2s)`,
          `‚Ä¢ Table of contents: ${audit.tocPresent >= 1 ? '1pt' : '0pts'}`,
        ]
      );
      
      // Add Visuals
      addCalculationBox(
        'Add Visuals',
        Math.round(breakdown.craft?.addVisuals || 0),
        6,
        'Images (0-2pts) + Tables (0-2pts) + Lists (0-1pt) + Videos (0-1pt)',
        [
          `‚Ä¢ Images: ${audit.images || 0} found`,
          `  Words per image: ${audit.images > 0 ? Math.round(wordCount / audit.images) : 'N/A'}`,
          `  (Optimal: 1 image per 300-500 words)`,
          `‚Ä¢ Comparison tables: ${audit.comparisonTables || 0} found`,
          `  Total tables: ${audit.tables || 0}`,
          `‚Ä¢ Lists (ul/ol): ${audit.lists || 0} found (need 3+ for bonus)`,
          `‚Ä¢ Videos embedded: ${audit.videos || 0} found`,
        ]
      );
      
      // FAQ Integration
      addCalculationBox(
        'FAQ Integration',
        Math.round(breakdown.craft?.faqIntegration || 0),
        4,
        'FAQ Count (0-2pts) + FAQ Quality (0-1pt) + FAQ Schema (0-1pt)',
        [
          `‚Ä¢ FAQ questions: ${audit.faqCount || 0} found ‚Üí ${audit.faqCount >= 8 ? '2pts' : audit.faqCount >= 5 ? '1pt' : '0pts'}`,
          `  (Optimal: 8+ comprehensive questions)`,
          `‚Ä¢ FAQ answer quality: ${audit.faqAvgWords || 0} words avg`,
          `  ‚Üí ${audit.faqAvgWords >= 100 ? '1pt' : '0pts'} (need 100+ words per answer)`,
          `‚Ä¢ FAQ schema markup: ${audit.schemaTypes?.includes('FAQPage') || audit.schemaTypes?.includes('Question') ? '1pt' : '0pts'}`,
        ]
      );
      
      // Trust Building
      addCalculationBox(
        'Trust Building',
        Math.round(breakdown.craft?.trustBuilding || 0),
        4,
        'Author Bio (0-2pts) + Credentials (0-1pt) + Testimonials (0-1pt)',
        [
          `‚Ä¢ Author bio present: ${audit.authorBio || 0} points`,
          `‚Ä¢ Credentials shown: ${audit.credentials || 0} point`,
          `‚Ä¢ Testimonials/social proof: ${audit.testimonials || 0} found`,
        ]
      );
      
      // ==================== PAGE 4: TECHNICAL SEO ====================
      
      doc.addPage();
      yPos = 20;
      
      addSectionHeader('Technical SEO Breakdown (20 points)', [34, 197, 94]);
      
      doc.setFontSize(8);
      doc.setTextColor(80, 80, 80);
      doc.text('Technical = Meta Optimization + Schema Markup + Internal Linking + Page Structure + Mobile', leftMargin, yPos);
      yPos += 7;
      
      // Meta Optimization
      addCalculationBox(
        'Meta Optimization',
        Math.round(breakdown.technical?.metaOptimization || 0),
        4,
        'Title Length (0-2pts) + Description Length (0-2pts)',
        [
          `‚Ä¢ Title: ${audit.metaTitleLength || 0} chars ‚Üí ${audit.metaTitleLength >= 50 && audit.metaTitleLength <= 60 ? '2pts' : audit.metaTitleLength >= 30 ? '1pt' : '0pts'}`,
          `‚Ä¢ Description: ${audit.metaDescLength || 0} chars ‚Üí ${audit.metaDescLength >= 150 && audit.metaDescLength <= 160 ? '2pts' : audit.metaDescLength >= 100 ? '1pt' : '0pts'}`,
        ]
      );
      
      // Schema Markup
      const schemaTypes = audit.schemaTypes || [];
      addCalculationBox(
        'Schema Markup',
        Math.round(breakdown.technical?.schemaMarkup || 0),
        4,
        'Article Schema (0-2pts) + Specialized Schema (0-2pts)',
        [
          `‚Ä¢ Schema types found: ${schemaTypes.length > 0 ? schemaTypes.join(', ') : 'None'}`,
          `‚Ä¢ Article/BlogPosting schema: ${schemaTypes.includes('Article') || schemaTypes.includes('NewsArticle') || schemaTypes.includes('BlogPosting') ? '2pts' : '0pts'}`,
          `‚Ä¢ Specialized schemas (HowTo/FAQ/Review/etc): ${schemaTypes.some(s => ['HowTo', 'FAQPage', 'Review', 'Recipe', 'Product'].includes(s)) ? '2pts' : '0pts'}`,
          `  (CRITICAL: Schema markup helps AI Overviews cite your content)`,
        ]
      );
      
      // Internal Linking
      addCalculationBox(
        'Internal Linking',
        Math.round(breakdown.technical?.internalLinking || 0),
        4,
        'Number of Internal Links (0-4pts)',
        [
          `‚Ä¢ Internal links found: ${audit.internalLinks || 0}`,
          `  ‚Üí ${audit.internalLinks >= 10 ? '4pts' : audit.internalLinks >= 5 ? '3pts' : audit.internalLinks >= 3 ? '2pts' : audit.internalLinks >= 1 ? '1pt' : '0pts'}`,
          `  (Optimal: 5-10 contextual internal links)`,
        ]
      );
      
      // Page Structure
      addCalculationBox(
        'Page Structure',
        Math.round(breakdown.technical?.pageStructure || 0),
        4,
        'H1 Count (0-1pt) + H2 Count (0-1pt) + Word Count (0-1pt) + Depth (0-1pt)',
        [
          `‚Ä¢ H1 headings: ${audit.headingCount?.h1 || 0} ‚Üí ${audit.headingCount?.h1 === 1 ? '1pt' : '0pts'} (must be exactly 1)`,
          `‚Ä¢ H2 headings: ${audit.headingCount?.h2 || 0} ‚Üí ${audit.headingCount?.h2 >= 3 ? '1pt' : '0pts'} (need 3+)`,
          `‚Ä¢ Word count: ${wordCount} ‚Üí ${wordCount >= 1500 ? '1pt' : '0pts'} (optimal: 1500+)`,
          `‚Ä¢ Content depth: ${audit.contentDepth || 0} point`,
        ]
      );
      
      // Mobile Optimization
      addCalculationBox(
        'Mobile Optimization',
        Math.round(breakdown.technical?.mobileOptimization || 0),
        4,
        'Responsive Design (0-2pts) + Alt Texts (0-1pt) + Readability (0-1pt)',
        [
          `‚Ä¢ Mobile responsive: ${audit.mobileResponsive || 0} points`,
          `  (Viewport meta + CSS media queries)`,
          `‚Ä¢ Alt texts: ${audit.altTexts || 0}/${audit.images || 0} images`,
          `  ‚Üí ${audit.images > 0 && (audit.altTexts / audit.images) >= 0.8 ? '1pt' : '0pts'} (need 80%+)`,
          `‚Ä¢ Mobile readability: ${audit.readabilityScore >= 60 ? '1pt' : '0pts'}`,
        ]
      );
      
      // ==================== PAGE 5: RECOMMENDATIONS ====================
      
      doc.addPage();
      yPos = 20;
      
      addSectionHeader('Priority Recommendations with Calculations', [239, 68, 68]);
      
      const recommendations = generateRecommendations(currentScanData);
      
      doc.setFontSize(8);
      doc.setTextColor(80, 80, 80);
      doc.text('These recommendations are ranked by impact. Fix Critical issues first for maximum score improvement.', leftMargin, yPos);
      yPos += 10;
      
      // Critical Issues
      if (recommendations.critical.length > 0) {
        doc.setFontSize(12);
        doc.setTextColor(239, 68, 68);
        doc.text('Critical Issues (Fix First)', leftMargin, yPos);
        yPos += 7;
        
        recommendations.critical.forEach((rec, idx) => {
          checkNewPage(30);
          
          doc.setFillColor(254, 242, 242);
          const boxHeight = 25 + (rec.calculation ? 15 : 0);
          doc.rect(leftMargin, yPos - 4, rightMargin - leftMargin, boxHeight, 'F');
          
          doc.setFontSize(10);
          doc.setTextColor(0, 0, 0);
          doc.setFont(undefined, 'bold');
          doc.text(`${idx + 1}. ${rec.text}`, leftMargin + 2, yPos);
          yPos += 5;
          
          if (rec.impact) {
            doc.setFont(undefined, 'normal');
            doc.setFontSize(9);
            doc.setTextColor(234, 88, 12);
            doc.text(`Impact: ${rec.impact}`, leftMargin + 4, yPos);
            yPos += 4;
          }
          
          if (rec.calculation) {
            doc.setFontSize(7);
            doc.setTextColor(80, 80, 80);
            const calcLines = doc.splitTextToSize(rec.calculation, rightMargin - leftMargin - 6);
            calcLines.forEach(line => {
              doc.text(line, leftMargin + 4, yPos);
              yPos += 3;
            });
            yPos += 2;
          }
          
          if (rec.solution) {
            doc.setFontSize(8);
            doc.setTextColor(22, 163, 74);
            doc.setFont(undefined, 'italic');
            const solLines = doc.splitTextToSize(`Solution: ${rec.solution}`, rightMargin - leftMargin - 6);
            solLines.forEach(line => {
              doc.text(line, leftMargin + 4, yPos);
              yPos += 3.5;
            });
            doc.setFont(undefined, 'normal');
          }
          
          yPos += 5;
        });
      }
      
      // Important Improvements
      if (recommendations.important.length > 0) {
        checkNewPage(20);
        
        doc.setFontSize(12);
        doc.setTextColor(234, 179, 8);
        doc.text('Important Improvements', leftMargin, yPos);
        yPos += 7;
        
        recommendations.important.slice(0, 3).forEach((rec, idx) => {
          checkNewPage(25);
          
          doc.setFillColor(254, 252, 232);
          const boxHeight = 20 + (rec.calculation ? 12 : 0);
          doc.rect(leftMargin, yPos - 4, rightMargin - leftMargin, boxHeight, 'F');
          
          doc.setFontSize(9);
          doc.setTextColor(0, 0, 0);
          doc.setFont(undefined, 'bold');
          doc.text(`${idx + 1}. ${rec.text}`, leftMargin + 2, yPos);
          yPos += 4;
          
          if (rec.impact) {
            doc.setFont(undefined, 'normal');
            doc.setFontSize(8);
            doc.setTextColor(234, 88, 12);
            doc.text(`Impact: ${rec.impact}`, leftMargin + 4, yPos);
            yPos += 4;
          }
          
          if (rec.calculation) {
            doc.setFontSize(7);
            doc.setTextColor(80, 80, 80);
            const calcLines = doc.splitTextToSize(rec.calculation, rightMargin - leftMargin - 6);
            calcLines.slice(0, 4).forEach(line => {
              doc.text(line, leftMargin + 4, yPos);
              yPos += 3;
            });
          }
          
          yPos += 5;
        });
      }
      
      // ==================== FOOTER ON ALL PAGES ====================
      
      const totalPages = doc.internal.getNumberOfPages();
      doc.setFontSize(7);
      doc.setTextColor(150, 150, 150);
      
      for (let i = 1; i <= totalPages; i++) {
        doc.setPage(i);
        doc.text(`Page ${i} of ${totalPages}`, leftMargin, 290);
        doc.text('Generated by SEO ContentScore - contentscale.site', 105, 290, { align: 'center' });
      }
      
      doc.save(`contentscore-full-analysis-${Date.now()}.pdf`);
      
      alert('‚úÖ Comprehensive PDF with all calculations exported!\n\nüìÑ Includes:\n‚Ä¢ Complete scoring breakdown\n‚Ä¢ Calculation formulas\n‚Ä¢ Priority recommendations\n‚Ä¢ Impact analysis');
    }

    function copyShareLink() {
      if (!currentShareId) {
        alert('No share ID available');
        return;
      }

      const shareUrl = `${window.location.origin}/scan-result/${currentShareId}`;
      
      navigator.clipboard.writeText(shareUrl).then(() => {
        alert(`‚úÖ Share link copied!\n\n${shareUrl}`);
      }).catch(() => {
        const textarea = document.createElement('textarea');
        textarea.value = shareUrl;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert(`‚úÖ Share link copied!\n\n${shareUrl}`);
      });
    }

    function generateShareId() {
      return 'scan-' + Math.random().toString(36).substring(2, 10) + Date.now().toString(36);
    }

    function showError(message) {
      const resultDiv = document.getElementById('scan-result');
      
      resultDiv.className = 'bg-red-900 border border-red-700 rounded-lg p-6';
      resultDiv.innerHTML = `
        <h3 class="font-bold text-xl mb-2">‚ùå Analysis Failed</h3>
        <p class="text-sm mb-3">${message}</p>
        <div class="text-xs text-gray-400 space-y-1">
          <p>üí° Common issues:</p>
          <ul class="list-disc list-inside ml-2 space-y-1">
            <li>URL must include https:// or http://</li>
            <li>Website must be publicly accessible</li>
            <li>Page must have sufficient content (300+ words)</li>
            <li>Website must be online and responsive</li>
          </ul>
        </div>
        <button onclick="document.getElementById('scan-result').classList.add('hidden')" class="mt-4 text-red-400 hover:text-red-300 text-sm font-bold">
          ‚úï Close
        </button>
      `;
      
      resultDiv.classList.remove('hidden');
      resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    function incrementScanCounter() {
      const scansUsed = parseInt(localStorage.getItem('scans_used') || '0');
      localStorage.setItem('scans_used', (scansUsed + 1).toString());
      
      if (scansUsed + 1 >= 5) {
        showLimitMessage();
      }
    }

    function showLimitMessage() {
      const notice = document.createElement('div');
      notice.className = 'bg-yellow-900 border border-yellow-700 rounded-lg p-4 mb-6 animate-pulse';
      notice.innerHTML = `
        <h4 class="font-bold mb-2">‚ö†Ô∏è Free Scan Limit Reached</h4>
        <p class="text-sm mb-3">
          You've used your 5 free scans today. For unlimited access and detailed reports:
        </p>
        <a href="https://contentscale.site/contact" class="inline-block bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded-lg font-bold text-sm transition">
          üöÄ Upgrade Now
        </a>
      `;
      
      const container = document.querySelector('.container');
      const firstCard = container.querySelector('.bg-gray-800');
      container.insertBefore(notice, firstCard);
    }

    document.addEventListener('DOMContentLoaded', function() {
      console.log('üìä ContentScore tool loaded');
      
      const lastReset = localStorage.getItem('last_reset');
      const today = new Date().toDateString();
      
      if (lastReset !== today) {
        localStorage.setItem('scans_used', '0');
        localStorage.setItem('last_reset', today);
        console.log('üîÑ Daily scan counter reset');
      }
      
      const scansUsed = parseInt(localStorage.getItem('scans_used') || '0');
      console.log(`üìà Scans used today: ${scansUsed}/5`);
      
      if (scansUsed >= 5) {
        showLimitMessage();
      }
    });
  </script>

</body>
</html>
